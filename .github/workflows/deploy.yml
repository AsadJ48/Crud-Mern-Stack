- name: Deploy to Azure VM
  run: |
    ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ${{ secrets.SSH_USERNAME }}@${{ secrets.SSH_HOST }} << 'EOF'
      cd ~/Crud-Mern-Stack

      echo "🔄 Pulling latest code..."
      git pull origin main

      echo "📦 Installing backend dependencies..."
      cd backend
      npm install

      echo "🚀 Restarting backend without PM2..."
      pkill node || true
      nohup node index.js > server.log 2>&1 &

      echo "🌐 Building frontend..."
      cd ../frontend
      npm install
      npm run build

      echo "✅ Deployment complete."
    EOF
